<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-csv/0.71/jquery.csv-0.71.min.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Crete+Round" rel="stylesheet">
 
  <script src="https://cdn.zingchart.com/zingchart.min.js"></script>

    <title>Live Tweets Analysis</title>
</head>

<body>
    <div class="topnav" id="myTopnav">
        <a href="#" class="active">Home</a>
        <a href="pie.html">Topics discussed</a>
        <a href="#">Lockdown Prediction</a>
        <a href="critical.html">Critical topics analysis</a>
        <a href="map.html">Covid-19 cases update</a>
        <a href="live-tweets.html">Live Tweets Sentiment Analysis</a>
        <a href="javascript:void(0);" class="icon" onclick="myFunction()">
            <i class="fa fa-bars"></i>
        </a>
    </div>
    <br><center>
<h1>Enter any hashtag to see live tweet analysis of 100 recent tweets </h1>
    <form id="myForm" style="padding:40px">
        <label for="topic">Enter the topic you want to analyze:</label>
        <input type="text" id="topic" name="topic"><br><br>
        <button type="submit" style="padding:10px;width:100px;">Query</button>
    </form></center>
    <table>
        <tr>
    <td><h3>Tweets categorized into Positive, Negative and Neutral</h3><div id="livebar" style="margin: 0 auto"></div></td>
    <td><h3>Live tweets extracted from Twitter</h3><div id="table" style="margin: 0 auto"></div></td></tr>
</table>
<center><table>
    <tr><td><h3>Word Cloud of most used words</h3><div id="wordcloud"></div></td></tr>
</table></center>
    <div id="loading" style="display:none;">
        <p ><img src="ajax-loader.gif" style="position: absolute;top: 50%;left: 50%;margin: -50px 0px 0px -50px;"/></p>
      </div>
      
    <script type="text/javascript">
        google.charts.load('current', { 'packages': ['corechart', 'bar', 'line','table'] });

        $('#myForm').on('submit', function (e) {
            e.preventDefault();
            $('#livebar').empty();
            $('#table').empty();
            $('#wordcloud').empty();
            document.getElementById('loading').style.display = "block";
            
            var q = document.getElementById('topic').value;
            console.log(q);
            $.ajax({
                type: "POST",
                url: "http://127.0.0.1:5000/liveTweets?hashtag=" + q,
                success: function (response) {
                    document.getElementById('loading').style.display = "none";

                    // Draw the pie chart and bar chart when Charts is loaded.
                    console.log(response);
                    ZC.LICENSE = ["569d52cefae586f634c54f86dc99e6a9", "b55b025e438fa8a98e32482b5f768ff5"];
                    zingchart.MODULESDIR = 'https://cdn.zingchart.com/modules/';
 
                    var myConfig = {
                        type: 'wordcloud',
                        options: {
                            text: response,
                            maxItems:50,
                            aspect:'flow-center',
                            colorType: 'palette',
                            palette: ['#D32F2F', '#5D4037', '#1976D2', '#E53935', '#6D4C41', '#1E88E5', '#F44336', '#795548', '#2196F3', '#EF5350', '#8D6E63', '#42A5F5'],
 
                            style: {
                                fontFamily: 'Crete Round',
                                hoverState: {
                                backgroundColor: '#D32F2F',
                                borderRadius: 2,
                                fontColor: 'white'
                                },
                                tooltip: {
                                text: '%text: %hits',
                                visible: true,
                                alpha: 0.9,
                                backgroundColor: '#1976D2',
                                borderRadius: 2,
                                borderColor: 'none',
                                fontColor: 'white',
                                fontFamily: 'Georgia',
                                textAlpha: 1
                                }
                            }
                        },
                    };
                    zingchart.render({
                    id: 'wordcloud',
                    data: myConfig,
                    height: 400,
                    width: '100%'
                    });
                    google.charts.setOnLoadCallback(drawChart);

                    function drawChart() {
                        csvUrl1 = 'http://localhost:3000/count.csv'
                        var queryOptions1 = {
                            csvColumns: ['string','number' /* Or whatever the columns in the CSV file are */],
                            csvHasHeader: true /* This should be false if your CSV file doesn't have a header */
                        }

                        var query1 = new google.visualization.Query(csvUrl1, queryOptions1);

                        query1.send(handleQueryResponse1);

                        csvUrl2 = 'http://localhost:3000/tweet_table.csv'
                        var queryOptions2 = {
                            csvColumns: ['number','string', 'string' /* Or whatever the columns in the CSV file are */],
                            csvHasHeader: true /* This should be false if your CSV file doesn't have a header */
                        }

                        var query2 = new google.visualization.Query(csvUrl2, queryOptions2);

                        query2.send(handleQueryResponse2);

                    }
                    function handleQueryResponse1(response1) {

                        if (response1.isError()) {
                            alert('Error in query: ' + response1.getMessage() + ' ' + response1.getDetailedMessage());
                            return;
                        }

                        var data_livebar = response1.getDataTable();
                        var chart_livebar = new google.visualization.BarChart(document.getElementById('livebar'));
                        chart_livebar.draw(data_livebar, { width: 725, height: 400, legend: 'none',bars:'vertical',title:'Count of Positive, Negative & Neutral Tweets' });
                    }
                    function handleQueryResponse2(response2) {

if (response2.isError()) {
    alert('Error in query: ' + response2.getMessage() + ' ' + response2.getDetailedMessage());
    return;
}

var data_table = response2.getDataTable();
var chart_table = new google.visualization.Table(document.getElementById('table'));
chart_table.draw(data_table, { width: 725, height: 400 });
}
                }



            });

        });

    </script>

</body>

</html>